<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026æ–°å¹´å¿«ä¹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            overflow: hidden; 
            background: #000; 
            font-family: "Microsoft YaHei", "SimHei", Arial, sans-serif;
        }
        #fireworkCanvas { 
            display: block; 
            background: #000; 
            position: absolute; 
            top: 0; 
            left: 0; 
            z-index: 1; 
            width: 100vw; 
            height: 100vh;
        }
        /* å€’è®¡æ—¶/2026æ•°å­—ç”»å¸ƒï¼šä¸¥æ ¼å±…ä¸­ï¼Œè§†è§‰æ ¸å¿ƒåŒº */
        #countdownCanvas { 
            position: fixed; 
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5; 
            display: none;
            object-fit: contain;
            max-width: 90vw;
            max-height: 50vh;
        }
        /* 2026åƒç´ æ•°å­—ç”»å¸ƒï¼šç‹¬ç«‹ç”»å¸ƒï¼Œç­‰å®½æ”¾å¤§ */
        #year2026Canvas {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 6;
            display: none;
            object-fit: contain;
            max-width: 95vw;
            max-height: 60vh;
        }
        .text-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10;
            pointer-events: none;
            opacity: 0;
            }
        .main-text {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            margin: 0;
            color: #fff;
            font-size: clamp(24px, 7vw, 60px);
            font-weight: bold;
            text-shadow: 0 0 25px #ffd700, 0 0 50px #ff0000, 0 0 80px #ff0000;
            opacity: 0;
            transition: opacity 0.5s ease;
            }
        .main-text.active {
            opacity: 1;
            }
        .control-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: clamp(12px, 3vw, 14px);
            opacity: 0.9;
            z-index: 20;
            background: rgba(0,0,0,0.7);
            padding: 6px 18px;
            border-radius: 12px;
            bottom: 20px !important;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .click-tip {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd700;
            font-size: 26px;
            text-shadow: 0 0 15px #ff0000, 0 0 30px #ff0000;
            z-index: 100;
            text-align: center;
            background: rgba(0,0,0,0.5);
            padding: 12px 24px;
            border-radius: 18px;
        }
         /* æ ¸å¿ƒæ ·å¼ï¼šæ§åˆ¶å›¾ç‰‡ä½ç½® */
        .top-right-image {
            position: fixed; /* å›ºå®šå®šä½ï¼Œæ»šåŠ¨é¡µé¢æ—¶ä½ç½®ä¸å˜ */
            top: 20px;       /* è·ç¦»é¡¶éƒ¨20pxï¼Œå¯è‡ªè¡Œè°ƒæ•´ */
            right: 20px;     /* è·ç¦»å³ä¾§20pxï¼Œå¯è‡ªè¡Œè°ƒæ•´ */
            width: clamp(80px, 25vw, 120px);   /* è®¾ç½®å›¾ç‰‡å®½åº¦ï¼Œé«˜åº¦ä¼šè‡ªåŠ¨ç­‰æ¯”ä¾‹ç¼©æ”¾ */
            z-index: 101; /* é«˜äºæ‰€æœ‰å…ƒç´ ï¼Œé¿å…è¢«é®æŒ¡ */
        }
    </style>
</head>
<body>
    <img 
        class="top-right-image" 
        src="./æ˜¥.png"
    >
    <div class="click-tip" id="clickTip">ç‚¹å‡»å±å¹• â†’ å¯åŠ¨éŸ³ä¹+å€’è®¡æ—¶+çƒŸèŠ±</div>
    <canvas id="fireworkCanvas"></canvas>
    <!-- å€’è®¡æ—¶æ•°å­—ç”»å¸ƒ -->
    <canvas id="countdownCanvas"></canvas>
    <!-- 2026åƒç´ æ•°å­—ç”»å¸ƒ -->
    <canvas id="year2026Canvas"></canvas>
    <div class="text-overlay" id="textOverlay">
        <div class="main-text" id="text0">æ–°</div>
        <div class="main-text" id="text1">å¹´</div>
        <div class="main-text" id="text2">å¿«</div>
        <div class="main-text" id="text3">ä¹</div>
        <div class="main-text" id="text4">æ„¿æˆ‘ä»¬</div>
        <div class="main-text" id="text5">æ–°çš„ä¸€å¹´</div>
        <div class="main-text" id="text6">å¥½è¿+1</div>
        <div class="main-text" id="text7">å¹¸ç¦+1</div>
        <div class="main-text" id="text8">å¥åº·+1</div>
        <div class="main-text" id="text9">è´¢å¯Œ+1</div>
        <div class="main-text" id="text10">å¹³å®‰å–œä¹</div>
        <div class="main-text" id="text11">ä¸‡äº‹é¡ºåˆ©</div>
        <div class="main-text" id="text12">2026æ–°å¹´å¿«ä¹!</div>
    </div>
    <div class="control-panel">
    ç©ºæ ¼=æ‰¹é‡çƒŸèŠ± | F11=å…¨å± | ESC=é€€å‡ºå…¨å±
    </div>
    <!-- æ–°å¢é‡å¯æŒ‰é’®ï¼šé»˜è®¤éšè—ï¼Œç»“æŸåæ˜¾ç¤º -->
    <button id="restartBtn" style="
        position: fixed;
        top: 60%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 99;
        padding: 15px 40px;
        font-size: 24px;
        font-weight: bold;
        color: #fff;
        background: linear-gradient(#ffd700, #ff9900);
        border: none;
        border-radius: 50px;
        box-shadow: 0 0 20px #ff0000;
        cursor: pointer;
        display: none;
    ">
        é‡æ–°å¼€å§‹
    </button>

    <script>
        // åƒç´ æ•°å­—ç‚¹é˜µï¼ˆ7x9 ç­‰å®½è®¾è®¡ï¼Œ0å’Œå…¶ä»–æ•°å­—è§†è§‰ä¸€è‡´ï¼‰
        const pixelDigits = {
            5: [[1,1,1,1,1,1,1],[1,0,0,0,0,0,0],[1,0,0,0,0,0,0],[1,1,1,1,1,1,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[1,1,1,1,1,1,1],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],
            4: [[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],
            3: [[1,1,1,1,1,1,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[1,1,1,1,1,1,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[1,1,1,1,1,1,1],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],
            2: [[1,1,1,1,1,1,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[1,1,1,1,1,1,1],[1,0,0,0,0,0,0],[1,0,0,0,0,0,0],[1,1,1,1,1,1,1],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],
            1: [[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1],[0,0,0,0,0,0,1]],
            // 0ï¼šä¼˜åŒ–ç‚¹é˜µï¼Œå’Œ2/6ä¿æŒç­‰å®½ï¼Œè§†è§‰ç»Ÿä¸€
            0: [[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],
            6: [[1,1,1,1,1,1,1],[1,0,0,0,0,0,0],[1,0,0,0,0,0,0],[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]]
        };

        // ğŸ”¥æ–°å¢ï¼šæ¸å˜å˜ç™½æ§åˆ¶å˜é‡ï¼ˆä»…ç”¨äºå€’è®¡æ—¶ï¼Œ2026ä¸å†ä½¿ç”¨ï¼‰
        let countdownBrightness = 0;    // å€’è®¡æ—¶äº®åº¦ï¼ˆ0-1ï¼Œ1ä¸ºçº¯ç™½ï¼‰
        const brightnessStep = 0.09;    // æ¯æ¬¡æ¸å˜çš„æ­¥é•¿ï¼ˆè¶Šå°è¶Šæ…¢ï¼‰
        let isCountdownFading = false;  // å€’è®¡æ—¶æ˜¯å¦å¼€å§‹æ¸å˜

        // æ–°å¢ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºæ‰‹æœºç«¯ï¼ˆå±å¹•å®½åº¦<768pxï¼‰
        const isMobile = window.innerWidth < 768;

        // æ ¸å¿ƒé…ç½®ï¼šğŸ”¥ã€2026ç­‰å®½æ”¾å¤§ã€‘+ 0è§†è§‰ç»Ÿä¸€ + 54321åŒ€é€Ÿ0.8ç§’
        const cfg = {
            digitSize: isMobile ? 40 : 50,     // å€’è®¡æ—¶æ•°å­—å¤§å°
            yearDigitSize: isMobile ? 300 : 400, // 2026æ•°å­—å¤§å°ï¼ˆæ”¾å¤§æ›´é†’ç›®ï¼‰
            color: '#ffd700',  // åƒç´ ä¸»è‰²ï¼ˆé‡‘è‰²ï¼‰
            glow: '#ff9900',   // å‘å…‰è‰²ï¼ˆæš–æ©™é‡‘ï¼Œæ›´æŸ”å’Œï¼‰
            year2026Color: '#ff0000', // 2026æ•°å­—ä¸»è‰²ï¼ˆçº¢è‰²ï¼‰
            year2026Glow: '#ff3333',  // 2026å‘å…‰è‰²ï¼ˆäº®çº¢ï¼‰
            interval: 0.8,     // å€’è®¡æ—¶æ•°å­—ç»Ÿä¸€é—´éš”ï¼ˆç§’ï¼‰
            startT: 4.5,       // å€’è®¡æ—¶å¯åŠ¨æ—¶é—´ï¼ˆäººå£°ç»“æŸç¬é—´ï¼‰
            fireworkRate: isMobile ? 0.02 : 0.03,// çƒŸèŠ±è‡ªåŠ¨ç”Ÿæˆé€Ÿåº¦
            yearShowTime: 8000,// 2026æ•°å­—æ˜¾ç¤ºæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
            digitGap: 3,       // 2026æ•°å­—é—´è·ï¼ˆé€‚ä¸­ï¼Œä¸æ‹¥æŒ¤ï¼‰
            scaleRatio: isMobile ? 1.0 : 1.2   // 2026æ•´ä½“rç¼©æ”¾æ¯”ä¾‹ï¼ˆæ›´å¤§å æ¯”ï¼‰
        };
        // è‡ªåŠ¨ç”ŸæˆåŒ€é€Ÿæ—¶é—´è½´
        cfg.timeline = [
            {t: cfg.startT, d: 5},
            {t: cfg.startT + cfg.interval, d: 4},
            {t: cfg.startT + cfg.interval*2, d: 3},
            {t: cfg.startT + cfg.interval*3, d: 2},
            {t: cfg.startT + cfg.interval*4, d: 1},
            {t: cfg.startT + cfg.interval*5, d: null}
        ];

        // å…¨å±€å…ƒç´ åˆå§‹åŒ–
        const [fwCanvas, fwCtx] = [document.getElementById('fireworkCanvas'), document.getElementById('fireworkCanvas').getContext('2d')];
        const [cdCanvas, cdCtx] = [document.getElementById('countdownCanvas'), document.getElementById('countdownCanvas').getContext('2d')];
        const [yearCanvas, yearCtx] = [document.getElementById('year2026Canvas'), document.getElementById('year2026Canvas').getContext('2d')];
        const [textOverlay, clickTip] = [document.getElementById('textOverlay'), document.getElementById('clickTip')];
        const textEls = Array.from(document.querySelectorAll('.main-text'));
        const restartBtn = document.getElementById('restartBtn'); // ğŸ”¥æ–°å¢é‡å¯æŒ‰é’®å˜é‡
        let [isInited, isCdEnd, isYearShow, cdIdx, textIdx, textTime, yearShowStart] = [false, false, false, 0, 0, 0, 0];
        let isFinished = false; // ğŸ”¥æ–°å¢ï¼šæ ‡è®°æµç¨‹æ˜¯å¦ç»“æŸ
        // èƒŒæ™¯éŸ³ä¹ï¼ˆä¿ç•™ä½ çš„è·¯å¾„ï¼‰
        const audio = new Audio("./ç»ˆä¼šä¸ä½ åŒè¡Œ.mp3"); 
        audio.loop = false; audio.volume = 0.9; audio.preload = 'auto';

        // çƒŸèŠ±æ–‡å­—åˆ—è¡¨+é…è‰²
        const fwTexts = ["5","4","3","2","1","2026","æ–°","å¹´","å¿«","ä¹","2026æ–°å¹´å¿«ä¹"];
        const colors = ['#ff0000','#ff6600','#ffd700','#ffff00','#00ff00','#00ffff','#9900ff','#ffffff'];
        let fireworks = [];

        // ç”»å¸ƒè‡ªé€‚åº”ï¼šçª—å£ç¼©æ”¾æ—¶ï¼Œæ‰€æœ‰æ•°å­—å§‹ç»ˆå±…ä¸­ï¼Œ2026ç­‰å®½æ”¾å¤§
        function resize() {
            // çƒŸèŠ±ç”»å¸ƒ
            fwCanvas.width = window.innerWidth;
            fwCanvas.height = window.innerHeight;

            // å€’è®¡æ—¶ç”»å¸ƒé€‚é…
            const cdScale = Math.min(window.innerWidth, window.innerHeight) * 0.3 / (7 * cfg.digitSize);
            cdCanvas.width = 7 * cfg.digitSize * cdScale * window.devicePixelRatio;
            cdCanvas.height = 9 * cfg.digitSize * cdScale * window.devicePixelRatio;
            cdCanvas.style.width = `${7 * cfg.digitSize * cdScale}px`;
            cdCanvas.style.height = `${9 * cfg.digitSize * cdScale}px`;
            cdCtx.scale(window.devicePixelRatio, window.devicePixelRatio);

            // 2026ç”»å¸ƒé€‚é…ï¼šç­‰å®½æ”¾å¤§ï¼Œé¢„ç•™é—´è·
            const totalWidth = 4 * (7 + cfg.digitGap) * cfg.yearDigitSize;
            const yearScale = Math.min(window.innerWidth, window.innerHeight) * cfg.scaleRatio / totalWidth;
            yearCanvas.width = totalWidth * yearScale * window.devicePixelRatio;
            yearCanvas.height = 9 * cfg.yearDigitSize * yearScale * window.devicePixelRatio;
            yearCanvas.style.width = `${totalWidth * yearScale}px`;
            yearCanvas.style.height = `${9 * cfg.yearDigitSize * yearScale}px`;
            yearCtx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }
        resize(); 
        window.addEventListener('resize', resize);

        // ç»˜åˆ¶å•ä¸ªåƒç´ æ•°å­—ï¼ˆå€’è®¡æ—¶ç”¨ï¼Œä¿ç•™æ¸å˜å˜ç™½æ•ˆæœï¼‰
        function drawDigit(d) {
            const scale = Math.min(window.innerWidth, window.innerHeight) * 0.3 / (7 * cfg.digitSize);
            cdCtx.clearRect(0, 0, cdCanvas.width/window.devicePixelRatio, cdCanvas.height/window.devicePixelRatio);
            
            // è®¡ç®—æ¸å˜é¢œè‰²ï¼ˆä»é‡‘è‰²â†’ç™½è‰²ï¼‰
            const baseColor = cfg.color.replace('#', '');
            const r = parseInt(baseColor.slice(0, 2), 16) + Math.floor(countdownBrightness * (255 - parseInt(baseColor.slice(0, 2), 16)));
            const g = parseInt(baseColor.slice(2, 4), 16) + Math.floor(countdownBrightness * (255 - parseInt(baseColor.slice(2, 4), 16)));
            const b = parseInt(baseColor.slice(4, 6), 16) + Math.floor(countdownBrightness * (255 - parseInt(baseColor.slice(4, 6), 16)));
            
            // å‘å…‰æ•ˆæœæ¸å˜
            const glowColor = cfg.glow.replace('#', '');
            const glowR = parseInt(glowColor.slice(0, 2), 16) + Math.floor(countdownBrightness * (255 - parseInt(glowColor.slice(0, 2), 16)));
            const glowG = parseInt(glowColor.slice(2, 4), 16) + Math.floor(countdownBrightness * (255 - parseInt(glowColor.slice(2, 4), 16)));
            const glowB = parseInt(glowColor.slice(4, 6), 16) + Math.floor(countdownBrightness * (255 - parseInt(glowColor.slice(4, 6), 16)));
            
            cdCtx.shadowColor = `rgb(${glowR}, ${glowG}, ${glowB})`; 
            cdCtx.shadowBlur = 30 * scale + countdownBrightness * 20 * scale; 
            cdCtx.fillStyle = `rgb(${r}, ${g}, ${b})`;
            
            pixelDigits[d].forEach((row, y) => {
                row.forEach((dot, x) => {
                    if (dot) cdCtx.fillRect(
                        x * cfg.digitSize * scale, 
                        y * cfg.digitSize * scale, 
                        (cfg.digitSize - 4) * scale, 
                        (cfg.digitSize - 4) * scale
                    );
                });
            });
            
            // æ¸å˜è¿›åº¦æ›´æ–°
            if (isCountdownFading && countdownBrightness < 1) {
                countdownBrightness += brightnessStep;
                if (countdownBrightness > 1) countdownBrightness = 1;
                requestAnimationFrame(() => drawDigit(d));
            }
        }

        // ç»˜åˆ¶2026åƒç´ æ•°å­—ï¼šç­‰å®½æ”¾å¤§ï¼Œç›´æ¥æ˜¾ç¤ºçº¢è‰²ï¼ˆæ— æ¸å˜ï¼‰
        function draw2026() {
            const totalWidth = 4 * (7 + cfg.digitGap) * cfg.yearDigitSize;
            const scale = Math.min(window.innerWidth, window.innerHeight) * cfg.scaleRatio / totalWidth;
            yearCtx.clearRect(0, 0, yearCanvas.width/window.devicePixelRatio, yearCanvas.height/window.devicePixelRatio);
            
            // éœ“è™¹æ¸å˜æ•ˆæœï¼šçº¢è‰²â†’é‡‘è‰²
            const gradient = yearCtx.createLinearGradient(0, 0, totalWidth * scale, 0);
            gradient.addColorStop(0, '#ff0000');
            gradient.addColorStop(0.5, '#ffd700');
            gradient.addColorStop(1, '#ff0000');
            
            // åŒå±‚å‘å…‰ï¼šå¤–å±‚çº¢è‰²å…‰æ™•+å†…å±‚é‡‘è‰²å…‰æ™•
            yearCtx.shadowColor = '#ff3333';
            yearCtx.shadowBlur = 60 * scale;
            yearCtx.fillStyle = gradient;
            
            const yearDigits = [2,0,2,6];
            yearDigits.forEach((digit, idx) => {
                const offsetX = idx * (7 + cfg.digitGap) * cfg.yearDigitSize * scale;
                pixelDigits[digit].forEach((row, y) => {
                    row.forEach((dot, x) => {
                        if (dot) yearCtx.fillRect(
                            offsetX + x * cfg.yearDigitSize * scale, 
                            y * cfg.yearDigitSize * scale, 
                            (cfg.yearDigitSize - 4) * scale, 
                            (cfg.yearDigitSize - 4) * scale
                        );
                    });
                });
            });
        }

        // çƒŸèŠ±ç²’å­ç±»
        class Particle {
            constructor(x, y, c, dx, dy) {
                this.x = x; this.y = y; this.c = c;
                this.life = Math.random()*80+60; this.maxL = this.life;
                this.s = Math.random()*3+2; 
                this.dx = dx; this.dy = dy; 
                this.g = 0.05; 
                this.decay = 0.96; 
            }
            update() {
                this.dy += this.g; 
                this.x += this.dx; 
                this.y += this.dy;
                this.dx *= this.decay; 
                this.dy *= this.decay;
                this.life--; 
                const alpha = this.life/this.maxL;
                fwCtx.beginPath(); 
                fwCtx.arc(this.x, this.y, this.s*alpha, 0, Math.PI*2);
                fwCtx.fillStyle = `${this.c}${Math.floor(alpha*255).toString(16).padStart(2, '0')}`; 
                fwCtx.fill();
                return this.life > 0;
            }
        }

        // æ–‡å­—çƒŸèŠ±ç±»
        class TextFirework {
            constructor(x = Math.random()*window.innerWidth, y = window.innerHeight) {
                this.x = x; this.y = y;
                this.text = fwTexts[Math.floor(Math.random()*fwTexts.length)];
                this.color = colors[Math.floor(Math.random()*colors.length)];
                this.speed = Math.random()*10+7; 
                this.targetY = Math.random()*(window.innerHeight/2)+80; 
                this.exploded = false; 
                this.particles = []; 
                this.genTextPath(); 
            }
            genTextPath() {
                const tCanvas = document.createElement('canvas'); 
                const tCtx = tCanvas.getContext('2d');
                const fs = this.text.length>4 ? 50 : 70; 
                tCanvas.width = 300; 
                tCanvas.height = 300;
                tCtx.font = `bold ${fs}px SimHei`; 
                tCtx.textAlign = 'center'; 
                tCtx.textBaseline = 'middle';
                tCtx.fillText(this.text, 150, 150); 
                const data = tCtx.getImageData(0,0,300,300).data;
                for (let y=0; y<300; y+=5) {
                    for (let x=0; x<300; x+=5) {
                        if (data[(y*300+x)*4+3] > 128) {
                            this.particles.push([(x-150)/150, (y-150)/150]);
                        }
                    }
                }
            }
            rise() {
                fwCtx.beginPath(); 
                fwCtx.arc(this.x, this.y, 5, 0, Math.PI*2); 
                fwCtx.fillStyle = this.color; 
                fwCtx.fill();
                this.y -= this.speed; 
                if (this.y <= this.targetY) this.exploded = true;
            }
            explode() {
                this.particles.forEach(([dx, dy]) => {
                    fireworks.push(new Particle(this.x, this.y, this.color, dx*Math.random()*8, dy*Math.random()*8));
                });
            }
            update() {
                this.exploded ? this.explode() : this.rise();
                return !this.exploded;
            }
        }

        // ä¸»åŠ¨ç”»å¾ªç¯ï¼šå€’è®¡æ—¶â†’2026â†’ç¥ç¦æ–‡å­— æ— ç¼è¡”æ¥
        function animate() {
            requestAnimationFrame(animate);
            fwCtx.fillStyle = 'rgba(0,0,0,0.09)'; 
            fwCtx.fillRect(0,0,fwCanvas.width,fwCanvas.height);

            if (isInited) {
                // è‡ªåŠ¨ç”ŸæˆçƒŸèŠ±ï¼ˆç»“æŸååœæ­¢ï¼‰
                if (Math.random() < cfg.fireworkRate && !isFinished) {
                    fireworks.push(new TextFirework());
                }
                // æ›´æ–°çƒŸèŠ±
                fireworks = fireworks.filter(f => f.update ? f.update() : f.update());

                // 1. å€’è®¡æ—¶é˜¶æ®µï¼ˆ54321ï¼‰
                if (!isCdEnd && !isFinished) {
                    const currentTime = audio.currentTime;
                    if (cdIdx < cfg.timeline.length) {
                        const {t, d} = cfg.timeline[cdIdx];
                        if (currentTime >= t) {
                            if (d) { 
                                cdCanvas.style.display = 'block'; 
                                // å¯åŠ¨å€’è®¡æ—¶æ¸å˜
                                isCountdownFading = true;
                                countdownBrightness = 0;
                                drawDigit(d); 
                            } else { 
                                // å€’è®¡æ—¶ç»“æŸï¼Œå¼€å§‹æ˜¾ç¤º2026ï¼ˆæ— æ¸å˜ï¼‰
                                isCdEnd = true; 
                                isYearShow = true;
                                cdCanvas.style.display = 'none';
                                yearCanvas.style.display = 'block';
                                draw2026();
                                yearShowStart = Date.now();
                                
                                // 2026å‡ºç°æ—¶ç”Ÿæˆå¤§é‡çƒŸèŠ±
                                for (let i = 0; i < 50; i++) {
                                    fireworks.push(new TextFirework(
                                        Math.random() * window.innerWidth,
                                        window.innerHeight + Math.random() * 100
                                    ));
                                }
                            }
                            cdIdx++;
                        }
                    }
                } 
                // 2. 2026æ•°å­—æ˜¾ç¤ºé˜¶æ®µ
                else if (isYearShow && !isFinished) {
                    // 2026æ˜¾ç¤ºæœŸé—´æé«˜çƒŸèŠ±ç”Ÿæˆé¢‘ç‡
                    if (Math.random() < 0.15) { 
                        fireworks.push(new TextFirework());
                    }
                    // 2026æ˜¾ç¤ºæŒ‡å®šæ—¶é•¿åï¼Œåˆ‡æ¢åˆ°ç¥ç¦æ–‡å­—
                    if (Date.now() - yearShowStart > cfg.yearShowTime) {
                        isYearShow = false;
                        yearCanvas.style.display = 'none';
                        textOverlay.style.opacity = 1;
                        textEls[0].classList.add('active');
                        textTime = Date.now();
                    }
                }
                // 3. ç¥ç¦æ–‡å­—åˆ‡æ¢é˜¶æ®µ
                else if (!isFinished) {
                    const textOrder = [0,1,2,3,4,5,6,7,8,9,10,11,12];
                    const durations = [800,800,800,800,1500,1500,1200,1200,1200,1500,1500,1500,0];
                    
                    // æ—¶é—´åˆ°äº†ï¼Œæ‰åˆ‡æ¢
                    if (durations[textIdx] > 0 && Date.now() - textTime > durations[textIdx]) {
                        // éšè—ä¸Šä¸€å¥
                        textEls[textOrder[textIdx]].classList.remove('active');
                        // åˆ‡æ¢åˆ°ä¸‹ä¸€å¥
                        textIdx++;
                        textTime = Date.now();
                        // æ˜¾ç¤ºæ–°çš„ä¸€å¥
                        textEls[textOrder[textIdx]].classList.add('active');

                        // åˆ°æœ€åä¸€å¥ä¸”éŸ³ä¹ç»“æŸï¼Œæ˜¾ç¤ºé‡å¯æŒ‰é’®
                        if (textIdx >= 12 && audio.ended) {
                            isFinished = true;
                            restartBtn.style.display = 'block';
                        }
                    }
                }
            }
        }

        // ğŸ”¥ç›‘å¬éŸ³ä¹æ’­æ”¾ç»“æŸäº‹ä»¶
        audio.addEventListener('ended', () => {
            // åªæœ‰å½“æ–‡å­—åˆ°æœ€åä¸€ä¸ªï¼ˆ2026æ–°å¹´å¿«ä¹ï¼‰æ—¶ï¼Œæ‰æ ‡è®°ç»“æŸ
            if (textIdx >= 12) {
                isFinished = true;
                restartBtn.style.display = 'block'; // æ˜¾ç¤ºé‡å¯æŒ‰é’®
            }
        });

        // äº¤äº’äº‹ä»¶
        document.addEventListener('click', (e) => {
            if (!isInited && !isFinished) { 
                isInited = true; 
                clickTip.style.display = 'none'; 
                audio.play().catch(err => console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼š', err)); 
            } else if (!isFinished) {
                fireworks.push(new TextFirework(e.clientX, e.clientY));
            }
        });
        document.addEventListener('keydown', (e) => {
            if (isInited && !isFinished) {
                if (e.code === 'Space') { 
                    e.preventDefault(); 
                    for (let i=0; i<15; i++) {
                        fireworks.push(new TextFirework());
                    }
                }
                if (e.code === 'F11') { 
                    e.preventDefault(); 
                    document.fullscreenElement ? document.exitFullscreen() : document.documentElement.requestFullscreen(); 
                }
                if (e.code === 'Escape' && document.fullscreenElement) {
                    document.exitFullscreen();
                }
            }
        });

        // ğŸ”¥é‡å¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼šé‡ç½®æ‰€æœ‰çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹
        restartBtn.addEventListener('click', () => {
            // 1. é‡ç½®æ‰€æœ‰çŠ¶æ€å˜é‡
            isInited = false;
            isCdEnd = false;
            isYearShow = false;
            isFinished = false;
            cdIdx = 0;
            textIdx = 0;
            textTime = 0;
            yearShowStart = 0;
            countdownBrightness = 0;
            isCountdownFading = false;
            
            // 2. æ¸…ç©ºçƒŸèŠ±
            fireworks = [];
            
            // 3. éšè—é‡å¯æŒ‰é’®ï¼Œæ˜¾ç¤ºåˆå§‹æç¤º
            restartBtn.style.display = 'none';
            clickTip.style.display = 'block';
            
            // 4. éšè—æ‰€æœ‰ç”»å¸ƒå’Œæ–‡å­—
            cdCanvas.style.display = 'none';
            yearCanvas.style.display = 'none';
            textOverlay.style.opacity = 0;
            
            // 5. é‡ç½®æ‰€æœ‰æ–‡å­—çš„activeçŠ¶æ€
            textEls.forEach(el => el.classList.remove('active'));
            
            // 6. é‡ç½®éŸ³ä¹ï¼ˆå›åˆ°å¼€å¤´ï¼‰
            audio.currentTime = 0;
        });

        // å¯åŠ¨åŠ¨ç”»
        animate();
    </script>
</body>
</html> 